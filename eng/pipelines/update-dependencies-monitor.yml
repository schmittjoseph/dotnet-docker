trigger: none
pr: none
variables:
- template: ../common/templates/variables/dotnet/common.yml
resources:
  pipelines:
  - pipeline: dotnetMonitorBuild
    source: dotnet-dotnet-monitor
    trigger:
      branches:
        include:
        - release/*
        - main
      tags:
        - Production
        - Signed
  
stages:
- stage: Monitor
  jobs:
  - job: UpdateDependencies
    displayName: Update Dependencies (dotnet/dotnet-monitor)
    pool:
      vmImage: $(defaultLinuxAmd64PoolImage)
    steps:
    - pwsh: $(engPath)/Get-MonitorDropVersions.ps1 -Channel $(MajorMinorVersion)/$(ChannelQuality)
      displayName: Get Versions
    - powershell: |
        $customArgs = "$(MajorMinorVersion) --product-version monitor=$(monitorVer) --version-source-name dotnet/dotnet-monitor/$(MajorMinorVersion) --stable-branding=$(stableBranding)"
        
        $customArgsArray = @($customArgs)
        echo "##vso[task.setvariable variable=customArgsArray]$($customArgsArray | ConvertTo-Json -Compress -AsArray)"
      displayName: Set Custom Args
    - template: steps/update-dependencies.yml
      parameters:
        customArgsArray: $(customArgsArray)
